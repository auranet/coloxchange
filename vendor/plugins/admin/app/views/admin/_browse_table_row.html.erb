<% row = browse_table_row %><% auto_expand = tree && session["expanded_#{class_name}"] && session["expanded_#{class_name}"].include?(row.id) %><% if advanced %><div class="sorted" id="<%= "#{class_name.singularize}_#{row.id}" %>">
  <table class="display"><% end %>
    <tr class="hover row<%= cycle 1,2 %>"<% unless advanced %> id="<%= "#{class_name.singularize}_#{row.id}" %>"<% end %>><% if deletable %>
      <td class="checkbox"><%= check_box_tag("models[]",row.id,false,:id => "checkbox_#{row.id}") %></td><% end %><% for column in columns %><% column_action = (column.is_a?(Hash) ? column.keys.first : column).to_s %>
      <td<% unless column == columns.last %> style="width:<%= width %>;"<% end %>><% if tree && column == columns.first %><div style="padding-left:<%= (row.ancestors.size * 19) %>px;"><% unless row.children.empty? %><%= link_to "&nbsp;",{:action => "browse",:model => class_name,:parent => row.id,:external => params[:action] == "browse" ? nil : "yes"},:class => "expand#{" expanded" if auto_expand}",:rel => "#{class_name.singularize}_#{row.id}_children" %><% end %><% end %><% begin; label = column_action.include?(".") ? row.send(column_action.split(".")[0]).send(column_action.split(".")[1]) : row.respond_to?(column_action) ? row.send(column_action) : "<i>None</li>"; rescue; label = "<i>None</i>"; end; %><% label = label.is_a?(String) ? label : label.is_a?(TrueClass) ? "Yes" : label.is_a?(FalseClass) ? "No" : label.to_s %><%= link_to_if(column == columns.first,label.clean(:except => ["img"]),{:action => "edit",:model => class_name.singularize,:id => row.id,:external => external ? "yes" : nil},:class => external ? "external" : nil,:rel => external ? class_name : nil) %><% if tree && column == columns.first %></div><% end %></td><% end %><% if advanced || deletable %>
      <td class="actions" nowrap="nowrap"><% if tree %><%= link_to "Add child",{:action => "edit",:model => class_name.singularize,:parent_id => row.id,:external => external ? "yes" : nil},:class => "add-link#{" external" if external}",:rel => external ? class_name : nil %> <% end %><%= link_to("Delete",{:controller => "admin",:action => "delete",:model => class_name.singularize,:id => row.id,:external => external ? "yes" : nil},:class => "delete-link#{" external" if external}",:rel => external ? class_name : nil) if deletable %></td><% if sortable %>
      <td class="handle">&nbsp;</td><% end %><% end %>
    </tr><% if advanced %>
  </table><% if tree %>
  <div id="<%= class_name.singularize %>_<%= row.id %>_children"><% if auto_expand %><%= render :partial => "browse_table_tree_rows",:locals => {:advanced => advanced,:class_name => class_name,:children => row.children,:columns => columns,:deletable => deletable,:external => external,:sortable => sortable,:tree => tree,:width => width} %><% end %></div><% end %>
</div><% end %>